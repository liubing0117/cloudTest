<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--<link href="css/bootstrap.min.css">-->
    <style>
        .autoSearchText{
            border:solid 1px #CFCFCF;
            height:20px;
            color:black;
        }
        .menu_v{
            margin:0;
            padding:0;
            line-height:20px;
            font-size:12px;
            list-style-type:none;
        }
        .menu_v li{
            margin:0;
            padding:0;
            line-height:20px;
            font-size:14px;
            list-style-type:none;
            float:none;
        }
        .menu_v li span{
            color:Red;
        }
        .autoSearchItem{
            border:solid 1px #CFCFCF;
            visibility:hidden;
            position:absolute;
            background-color:white;
            overflow-y:auto;
        }

        .tb{
            text-align: center;
            border-width:2px;
            border-collapse:collapse;
            border-color:black;
            border-style:solid;
        }
        .tr{
            height:100px;
        }
        td{
            border-width:2px;
            border-collapse:collapse;
            border-color:black;
            border-style:solid;
        }
        #operation{
            background:dodgerblue;
        }
    </style>
</head>
<body>
    <form id="form1" runat="server">
        <div>
            <input id="metric_nameSearch" type="text" placeholder="请输入metric_name"/>
            <input id="tags_nameSearch" type="text" placeholder="请输入tags_name">
            <input type="button" id="button1" value="查看">
            <input type="button" id="button2" value="定制">
        </div>
    </form>
    <br />
    <br />
    <table width="600" height="400" border="2" cellpadding="0" cellspacing="0" class="tb">
        <tr>
            <td></td>
            <td>复选框</td>
            <td>功能按钮</td>
            <td>title</td>
            <td>metric</td>
            <td>tags1</td>
            <td>tags2</td>
            <td>...</td>
            <td>graph_name</td>
            <td>graph_num</td>
        </tr>
        <tr class="tr">
            <td> </td>
            <td id="operation">查看</td>
            <td>Disk(md5值)</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
        </tr>
        <tr>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
        </tr>
        <tr>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
        </tr>
        <tr>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
        </tr>
        <tr>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
        </tr>
    </table>
    <!--<div class="panel-group">-->
        <!--<div class="panel panel-primary">-->
            <!--<div class="panel-heading">-->
                <!--列表-->
            <!--</div>-->
            <!--<div class="panel-body">-->
                <!--<div class="list-op" id="list_op">-->
                    <!--<button type="button" class="btn btn-default btn-sm">-->
                        <!--<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增-->
                    <!--</button>-->
                    <!--<button type="button" class="btn btn-default btn-sm">-->
                        <!--<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改-->
                    <!--</button>-->
                    <!--<button type="button" class="btn btn-default btn-sm">-->
                        <!--<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除-->
                    <!--</button>-->
                <!--</div>-->
            <!--</div>-->
            <!--<table class="table table-bordered table-hover">-->
                <!--<thead>-->
                <!--<tr class="success">-->
                    <!--<th>类别编号</th>-->
                    <!--<th>类别名称</th>-->
                    <!--<th>类别组</th>-->
                    <!--<th>状态</th>-->
                    <!--<th>说明</th>-->
                <!--</tr>-->
                <!--</thead>-->
                <!--<tbody>-->
                <!--<tr>-->
                    <!--<td>C00001</td>-->
                    <!--<td>机车</td>-->
                    <!--<td>机车</td>-->
                    <!--<td>有效</td>-->
                    <!--<td>机车头</td>-->
                <!--</tr>-->
                <!--<tr>-->
                    <!--<td>C00002</td>-->
                    <!--<td>车厢</td>-->
                    <!--<td>机车</td>-->
                    <!--<td>有效</td>-->
                    <!--<td>载客车厢</td>-->
                <!--</tr>-->
                <!--</tbody>-->
            <!--</table>-->
        <!--</div>-->
    <!--</div>-->
</body>
    <script src="../static/js/jquery-3.1.1.min.js"></script>
<script>
    $(document).ready(function() {
        /*实时加载metric_name搜索数据*/
        $("#metric_nameSearch").off().on("keyup",function(e) {
            var position = $(this).position();
            var arrData = new Array();
            if (this.value != "") {
                $.ajax({
                    type:"GET",
                    url:"http://120.52.42.104:8087/QueryMetricName.do",
                    data:{metric_name:this.value},
                    async:false,
                    jsonp: "callback",
                    dataType:"jsonp",
                    jsonpCallback:"jsonpCallback",
                    cache: false,
                    success: function(data) {
                        //for循环取值
                        for (var i = 0; i < data.code.length; i++) {
                            arrData.push(data.code[i]);
                        }

                        var itemIndex = 0;
                        if($('#metric_nameSearchItem')){
                            $('#metric_nameSearchItem').remove();
                        }
                        var autoSearchItem = '<div id="metric_nameSearchItem" class="autoSearchItem"><ul class="menu_v"></ul></div>';
                        $("#metric_nameSearch").after(autoSearchItem);
                        var itemCount = $('li').length; //项个数

                        /*鼠标按下键时，显示下拉框，并且划过项时改变背景色及赋值给输入框*/
                        $('#metric_nameSearchItem').css({ 'visibility': 'visible', 'left': position.left, 'top': position.top + 24 });

                        initItem($(this), arrData);
                        var itemCount = $('li').length;


                        /*初始化下拉框数据,鼠标移过每项时，改变背景色并且将项的值赋值给输入框*/
                        function initItem(obj, data) {
                            var str = "";
                            if (data.length == 0) {
                                $('#metric_nameSearchItem ul').html('<div style="text-align:center;color:red;">无符合数据<div>');

                            }
                            else {
                                for (var i = 1; i <= data.length; i++) {
                                    str += "<li><span>" + i + "/" + data.length + "</span>\r<font>" + data[i - 1] + "</font></li>";
                                }
                                $('#metric_nameSearchItem ul').html(str);
                            }
                            /*点击项时将值赋值给搜索文本框*/
                            $('li').each(function() {
                                $(this).bind('click', function() {
                                    $("#metric_nameSearch").val($(this).find('font').text());
                                    $('#metric_nameSearchItem').css('visibility', 'hidden');
                                });
                            });
                            /*鼠标划过每项时改变背景色*/
                            $('li').each(function() {
                                $(this).hover(
                                        function() {
                                            $('li:nth-child(' + itemIndex + ')').css({ 'background': 'white', 'color': 'black' });
                                            itemIndex = $('li').index($(this)[0]) + 1;
                                            $(this).css({ 'background': 'blue', 'color': 'white' });
                                            //$('#metric_nameSearch').val($('li:nth-child(' + itemIndex + ')').find('font').text());
                                        },
                                        function() {
                                            $(this).css({ 'background': 'white', 'color': 'black' });
                                        }
                                );
                            });
                        };
                    },
                    Error: function(err) {
                        alert(err);
                    }
                });
            }
            /*点击空白处隐藏下拉框*/
            $(document).off().click(function() {
                $('.autoSearchText').css('visibility', 'hidden');
            });
        });
        //实时加载tags_name搜索数据
        $("#tags_nameSearch").off().on("keyup",function(e) {
            var position = $(this).position();
            var arrData = new Array();
            if (this.value != "") {
                $.ajax({
                    type:"GET",
                    url:"http://120.52.42.104:8087/QueryTagName.do",
                    data:{metric_name:$('#metric_nameSearch').val(),tags_name:this.value},
                    jsonp: "callback",
                    dataType:"jsonp",
                    jsonpCallback:"jsonpCallback",
                    cache: false,
                    success: function(data) {
                        //for循环取值
                        for (var i = 0; i < data.code.length; i++) {
                            arrData.push(data.code[i]);
                        }

                        var itemIndex = 0;
                        if($('#tags_nameSearchItem')){
                            $('#tags_nameSearchItem').remove();
                        }
                        var autoSearchItem = '<div id="tags_nameSearchItem" class="autoSearchItem"><ul class="menu_v"></ul></div>';
                        $("#tags_nameSearch").after(autoSearchItem);
                        var itemCount = $('li').length; //项个数

                        /*鼠标按下键时，显示下拉框，并且划过项时改变背景色及赋值给输入框*/
                        $('#tags_nameSearchItem').css({ 'visibility': 'visible', 'left': position.left, 'top': position.top + 24 });
                        initItem($(this), arrData);
                        var itemCount = $('li').length;


                        /*初始化下拉框数据,鼠标移过每项时，改变背景色并且将项的值赋值给输入框*/
                        function initItem(obj, data) {
                            var str = "";
                            if (data.length == 0) {
                                $('#tags_nameSearchItem ul').html('<div style="text-align:center;color:red;">无符合数据<div>');

                            }
                            else {
                                for (var i = 1; i <= data.length; i++) {
                                    str += "<li><span>" + i + "/" + data.length + "</span>\r<font>" + data[i - 1] + "</font></li>";
                                }
                                $('#tags_nameSearchItem ul').html(str);
                            }
                            /*点击项时将值赋值给搜索文本框*/
                            $('li').each(function() {
                                $(this).bind('click', function() {
                                    $("#tags_nameSearch").val($(this).find('font').text());
                                    $('#tags_nameSearchItem').css('visibility', 'hidden');
                                });
                            });
                            /*鼠标划过每项时改变背景色*/
                            $('li').each(function() {
                                $(this).hover(
                                        function() {
                                            $('li:nth-child(' + itemIndex + ')').css({ 'background': 'white', 'color': 'black' });
                                            itemIndex = $('li').index($(this)[0]) + 1;
                                            $(this).css({ 'background': 'blue', 'color': 'white' });
                                            //$("#tags_nameSearch").val($('li:nth-child(' + itemIndex + ')').find('font').text());
                                        },
                                        function() {
                                            $(this).css({ 'background': 'white', 'color': 'black' });
                                        }
                                );
                            });
                        };
                    },
                    Error: function(err) {
                        alert(err);
                    }
                });
            }
            /*点击空白处隐藏下拉框*/
            $(document).click(function() {
                $('.autoSearchItem').css('visibility', 'hidden');
            });
        });
    });



    $(function(){
        function initTableCheckbox() {
            var $thr = $('table thead tr');
            var $checkAllTh = $('<th><input type="checkbox" id="checkAll" name="checkAll" /></th>');
            /*将全选/反选复选框添加到表头最前，即增加一列*/
            $thr.prepend($checkAllTh);
            /*“全选/反选”复选框*/
            var $checkAll = $thr.find('input');
            $checkAll.click(function(event){
                /*将所有行的选中状态设成全选框的选中状态*/
                $tbr.find('input').prop('checked',$(this).prop('checked'));
                /*并调整所有选中行的CSS样式*/
                if ($(this).prop('checked')) {
                    $tbr.find('input').parent().parent().addClass('warning');
                } else{
                    $tbr.find('input').parent().parent().removeClass('warning');
                }
                /*阻止向上冒泡，以防再次触发点击操作*/
                event.stopPropagation();
            });
            /*点击全选框所在单元格时也触发全选框的点击操作*/
            $checkAllTh.click(function(){
                $(this).find('input').click();
            });
            var $tbr = $('table tbody tr');
            var $checkItemTd = $('<td><input type="checkbox" name="checkItem" /></td>');
            /*每一行都在最前面插入一个选中复选框的单元格*/
            $tbr.prepend($checkItemTd);
            /*点击每一行的选中复选框时*/
            $tbr.find('input').click(function(event){
                /*调整选中行的CSS样式*/
                $(this).parent().parent().toggleClass('warning');
                /*如果已经被选中行的行数等于表格的数据行数，将全选框设为选中状态，否则设为未选中状态*/
                $checkAll.prop('checked',$tbr.find('input:checked').length == $tbr.length ? true : false);
                /*阻止向上冒泡，以防再次触发点击操作*/
                event.stopPropagation();
            });
            /*点击每一行时也触发该行的选中操作*/
            $tbr.click(function(){
                $(this).find('input').click();
            });
        }
        initTableCheckbox();
    });
</script>
    <script>
        //获取搜索文本框数据
        $("#searchTextOne").on("keyup",function (e) {
            if(this.value != ""){
                $.ajax({
                    url:"http://120.52.42.104:8087/QueryMetricName.do",
                    data:{metric_name:this.value},
                    type:"GET",
                    jsonp: "callback",
                    dataType:"jsonp",
                    jsonpCallback:"jsonpCallback",
                    success:function(ack) {
                        var arr = ack.code;
                        console.log(arr);
                        console.log(arr[0]);
                    },
                    error:function(result) {
                        console.log(result);
                    }
                });
            }
            //console.log(this.value);
        });
    </script>
</html>